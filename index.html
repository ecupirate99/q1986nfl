<script>
  const form = document.getElementById('queryForm');
  const tableBody = document.querySelector('#resultsTable tbody');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const params = new URLSearchParams(new FormData(form)).toString();

    try {
      const res = await fetch(`/.netlify/functions/players?${params}`);

      if (!res.ok) {
        // Show error on page
        tableBody.innerHTML = `<tr><td colspan="10">Error: ${res.status} ${res.statusText}</td></tr>`;
        console.error("Fetch error:", res.status, res.statusText);
        return;
      }

      const data = await res.json();

      // Clear previous results
      tableBody.innerHTML = "";

      if (!Array.isArray(data) || data.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='10'>No results found</td></tr>";
        console.warn("No results returned for query:", params);
        return;
      }

      // Populate table
      data.forEach(p => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${p.Player || ""}</td>
          <td>${p.Team || ""}</td>
          <td>${p.Pos || ""}</td>
          <td>${p.G || ""}</td>
          <td>${p.Cmp || ""}</td>
          <td>${p.Att || ""}</td>
          <td>${p.Yds || ""}</td>
          <td>${p.TD || ""}</td>
          <td>${p.Int || ""}</td>
          <td>${p.Rate || ""}</td>
        `;
        tableBody.appendChild(row);
      });

    } catch (err) {
      // Show error on page
      tableBody.innerHTML = `<tr><td colspan="10">Error: ${err.message}</td></tr>`;
      // Log full error in browser console
      console.error("Unexpected error:", err);
    }
  });
</script>
